{% extends 'base.html' %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="/static/css/job_detail.css"></link>
<link rel="stylesheet" href="/static/css/job_graph.css"></link>
<script>
  var jobName = '{{ job.name }}';
</script>
{% endblock head %}

{% block navbar_current %}
<li><a href='#'>Job Detail: {{ job.name }}</a></li>
{% endblock navbar_current %}

{% block content %}
<div class='page-header'>
  <h3>Job Detail: {{ job.name }}</h3>
  <h3 id='job-status' class='right'></h3>
</div>

<div class='job-graph'>
</div>

<div class='row' id='config'>
  <div class='span6'>
    <h3>Job Scheduling</h3>

    <div id='schedule-alert' class='alert hidden'>
    </div>

    <form class='form form-horizontal'>

      <div class='control-group'>
        <label class='control-label' for='cron-schedule'>Cron Schedule String<br />(M H DoM Mon DoW)</label>
        <div class='controls'>
          <input id='cron-schedule' type='text' class='input' value='{{ job.cron_schedule }}'></input>
        </div>
      </div>

      <div class='control-group'>
        <label class='control-label' for='next-run'>Next Scheduled Run</label>
        <div class='controls'>
          <input id='next-run' type='text' class='input' disabled></input>
        </div>
      </div>

      <div class='control-group'>
        <div class='controls'>
          <button id='save-schedule' class='btn btn-success' onclick='return false;'>Save Schedule</button>
        </div>
      </div>

    </form>

  </div>
  <div class='span6'>
    <h3>Job State Control</h3>

    <div id='state-alert' class='alert hidden'>
    </div>

    <button id='start-job' class='btn btn-sequence btn-success'>Start Job From Beginning</button>
    <button id='retry-job' class='btn btn-sequence btn-success'>Retry Job from Failure</button>
    <br /><br />
    <button id='terminate-job' class='btn btn-sequence btn-warning'>Terminate Running Tasks</button>
    <button id='kill-job' class='btn btn-sequence btn-danger'>Kill Running Tasks</button>
  </div>
</div>

<h3>{{ job.name }}'s Tasks</h3>
<table class='table'>
  <thead>
    <th>Task</th>
    <th>Started</th>
    <th>Completed</th>
    <th>Result</th>
    <th>Task Detail</th>
  </thead>
  <tbody id='tasks-body'>
    {% for task in job.tasks %}
      <tr data-task='{{task.name}}'>
        <td data-attr='name'></td>
        <td data-attr='started_at' data-transform='datetime'></td>
        <td data-attr='completed_at' data-transform='datetime'></td>
        <td>
          <span data-attr='success' data-transform='class-success'></span>
        </td>
        <td>
          <button class='btn btn-primary' onclick="window.location.href = '{{ url_for('task_detail', job_id=job.job_id, task_name=task.name) }}';">View Task</button>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock content %}

{% block body_scripts %}
<script src="/static/js/job_model.js"></script>
<script src="/static/js/job_graph.js"></script>
<script src="/static/js/job_detail.js"></script>
{% endblock body_scripts %}
